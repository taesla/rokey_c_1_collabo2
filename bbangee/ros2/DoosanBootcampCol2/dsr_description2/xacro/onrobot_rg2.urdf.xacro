<?xml version="1.0"?>
<!--
  OnRobot RG2 Gripper URDF (Simplified for ROS2)
  Based on: https://github.com/ikalevatykh/onrobot_ros
  Config values from: rg2_v1.yaml
-->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="onrobot_rg2">

  <!-- Materials -->
  <material name="rg2/grey">
    <color rgba="0.5 0.5 0.5 1.0"/>
  </material>
  <material name="rg2/light_grey">
    <color rgba="0.8 0.8 0.8 1.0"/>
  </material>
  <material name="rg2/dark_grey">
    <color rgba="0.3 0.3 0.3 1.0"/>
  </material>

  <!-- RG2 Gripper Macro -->
  <xacro:macro name="onrobot_rg2" params="parent prefix:=gripper *origin">

    <!-- Bracket (connects to robot flange) -->
    <link name="${prefix}_bracket">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/single_bracket.stl"/>
        </geometry>
        <material name="rg2/grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/single_bracket.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.09"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_bracket_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="${prefix}_bracket"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <!-- Body -->
    <link name="${prefix}_body">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/body.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/body.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.65"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_body_joint" type="fixed">
      <parent link="${prefix}_bracket"/>
      <child link="${prefix}_body"/>
      <origin xyz="0.0 0.0 0.05" rpy="0 0 0"/>
    </joint>

    <!-- ========== LEFT FINGER (Finger 1) ========== -->
    <!-- Origin frame for left finger -->
    <link name="${prefix}_finger_1_origin">
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.00001" iyy="0.00001" izz="0.00001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_1_origin_joint" type="fixed">
      <parent link="${prefix}_body"/>
      <child link="${prefix}_finger_1_origin"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>

    <!-- Moment Arm Left -->
    <link name="${prefix}_finger_1_moment_arm">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/moment_arm.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/moment_arm.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_joint" type="fixed">
      <parent link="${prefix}_finger_1_origin"/>
      <child link="${prefix}_finger_1_moment_arm"/>
      <origin xyz="-0.017 0.0 0.055" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
    </joint>

    <!-- Truss Arm Left -->
    <link name="${prefix}_finger_1_truss_arm">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/truss_arm.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/truss_arm.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_1_truss_arm_joint" type="fixed">
      <parent link="${prefix}_finger_1_origin"/>
      <child link="${prefix}_finger_1_truss_arm"/>
      <origin xyz="-0.0075 0.0 0.0715" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
    </joint>

    <!-- Finger Tip Left -->
    <link name="${prefix}_finger_1_finger_tip">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/finger_tip.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/finger_tip.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_1_finger_tip_joint" type="fixed">
      <parent link="${prefix}_finger_1_truss_arm"/>
      <child link="${prefix}_finger_1_finger_tip"/>
      <origin xyz="-0.0256 0.0 0.04868" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
    </joint>

    <!-- Flex Finger Left -->
    <link name="${prefix}_finger_1_flex_finger">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/flex_finger.stl"/>
        </geometry>
        <material name="rg2/dark_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/flex_finger.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_1_flex_finger_joint" type="fixed">
      <parent link="${prefix}_finger_1_finger_tip"/>
      <child link="${prefix}_finger_1_flex_finger"/>
      <origin xyz="0.03059 0.0 0.0172" rpy="0 0 0"/>
    </joint>

    <!-- ========== RIGHT FINGER (Finger 2) ========== -->
    <!-- Origin frame for right finger (rotated 180 degrees) -->
    <link name="${prefix}_finger_2_origin">
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.00001" iyy="0.00001" izz="0.00001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_2_origin_joint" type="fixed">
      <parent link="${prefix}_body"/>
      <child link="${prefix}_finger_2_origin"/>
      <origin xyz="0 0 0" rpy="0 0 ${pi}"/>
    </joint>

    <!-- Moment Arm Right -->
    <link name="${prefix}_finger_2_moment_arm">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/moment_arm.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/moment_arm.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_mirror_joint" type="fixed">
      <parent link="${prefix}_finger_2_origin"/>
      <child link="${prefix}_finger_2_moment_arm"/>
      <origin xyz="-0.017 0.0 0.055" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
    </joint>

    <!-- Truss Arm Right -->
    <link name="${prefix}_finger_2_truss_arm">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/truss_arm.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/truss_arm.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_2_truss_arm_joint" type="fixed">
      <parent link="${prefix}_finger_2_origin"/>
      <child link="${prefix}_finger_2_truss_arm"/>
      <origin xyz="-0.0075 0.0 0.0715" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
    </joint>

    <!-- Finger Tip Right -->
    <link name="${prefix}_finger_2_finger_tip">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/finger_tip.stl"/>
        </geometry>
        <material name="rg2/light_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/finger_tip.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_2_finger_tip_joint" type="fixed">
      <parent link="${prefix}_finger_2_truss_arm"/>
      <child link="${prefix}_finger_2_finger_tip"/>
      <origin xyz="-0.0256 0.0 0.04868" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
    </joint>

    <!-- Flex Finger Right -->
    <link name="${prefix}_finger_2_flex_finger">
      <visual>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/visual/flex_finger.stl"/>
        </geometry>
        <material name="rg2/dark_grey"/>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://dsr_description2/meshes/collision/flex_finger.stl"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.001"/>
        <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
      </inertial>
    </link>

    <joint name="${prefix}_finger_2_flex_finger_joint" type="fixed">
      <parent link="${prefix}_finger_2_finger_tip"/>
      <child link="${prefix}_finger_2_flex_finger"/>
      <origin xyz="0.03059 0.0 0.0172" rpy="0 0 0"/>
    </joint>

    <!-- Grasp Frame (TCP) -->
    <link name="${prefix}_grasp_frame"/>

    <joint name="${prefix}_grasp_frame_joint" type="fixed">
      <parent link="${prefix}_body"/>
      <child link="${prefix}_grasp_frame"/>
      <origin xyz="0.0 0.0 0.14" rpy="0 0 0"/>
    </joint>

  </xacro:macro>

</robot>
